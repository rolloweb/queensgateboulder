<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Queensgate Bouldering — Bank Model</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:#f5f7fa;color:#243447;padding:20px}
  .container{max-width:1200px;margin:0 auto;background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
  .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:28px}
  .header h1{font-size:1.9rem;margin-bottom:6px}
  .header p{opacity:.95}
  .content{padding:24px}
  .section{border:1px solid #e6e8eb;border-radius:10px;margin-bottom:24px;overflow:hidden}
  .section-header{background:#f8f9fb;padding:14px 18px;border-bottom:1px solid #e6e8eb;display:flex;align-items:center;justify-content:space-between}
  .section-title{font-weight:700}
  .section-content{padding:18px}
  .grid{display:grid;gap:14px}
  .grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .grid.cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}
  @media (max-width:900px){.grid.cols-4{grid-template-columns:repeat(2,minmax(0,1fr))}}
  @media (max-width:700px){
    .grid.cols-3{grid-template-columns:1fr}
    .grid.cols-2{grid-template-columns:1fr}
    .grid.cols-4{grid-template-columns:1fr}
  }
  label{font-size:.9rem;color:#5b6776}
  .input{display:flex;gap:8px;align-items:center}
  .input input,.input select{margin-left:auto;min-width:140px;padding:8px 10px;border:1px solid #d7dbe0;border-radius:8px;font-size:15px;text-align:right}
  .stack{display:flex;flex-direction:column;gap:4px}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#3949ab;font-weight:600;font-size:.85rem}
  .metrics{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;background:#f8f9fb;border:1px solid #e6e8eb;border-radius:10px;padding:16px;margin-bottom:18px}
  .metric{text-align:center}
  .metric .v{font-size:1.45rem;font-weight:800;color:#667eea}
  .metric .l{font-size:.85rem;color:#6b7280;margin-top:2px}
  .btnbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .btn{padding:10px 16px;border:2px solid #667eea;background:#fff;color:#667eea;border-radius:10px;font-weight:700;cursor:pointer}
  .btn:hover{background:#667eea;color:#fff}
  .btn.active{background:#667eea;color:#fff;box-shadow:0 0 0 2px #667eea22 inset}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{border-bottom:1px solid #edf0f2;padding:10px 8px;text-align:right}
  .table th:first-child,.table td:first-child{text-align:left}
  .table thead th{background:#f8f9fb;font-weight:700}
  .good{color:#2e7d32;font-weight:700}
  .warn{color:#d32f2f;font-weight:700}
  .note{font-size:.9rem;color:#5b6776;margin-top:8px}
  .foot{background:#faf7ff;border:1px solid #e0d7f6;border-left:4px solid #6a1b9a;border-radius:8px;padding:14px;margin-top:16px}
  .kbd{background:#eef2ff;border:1px solid #d7dcff;border-radius:6px;padding:2px 6px}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Queensgate Bouldering — Funding Model</h1>
    <p>Supplier-quoted build, stepped lease terms, conservative pricing, 5-year P&amp;L, loan sizing and DSCR checks.</p>
  </div>

  <div class="content">

    <!-- SCENARIOS -->
    <div class="section">
      <div class="section-header">
        <div class="section-title">Scenario</div>
        <div class="pill" id="scenario-pill">Conservative</div>
      </div>
      <div class="section-content">
        <div class="btnbar">
          <button class="btn active" data-s="conservative">Conservative</button>
          <button class="btn" data-s="realistic">Realistic</button>
          <button class="btn" data-s="optimistic">Optimistic</button>
        </div>
        <p class="note">All scenarios use supplier quotes for build. Price and volume assumptions are conservative vs local competitors.</p>
      </div>
    </div>

    <!-- TOP METRICS -->
    <div class="metrics">
      <div class="metric"><div class="v" id="m-capex-ex">£0</div><div class="l">CAPEX ex VAT</div></div>
      <div class="metric"><div class="v" id="m-capex-inc">£0</div><div class="l">CAPEX incl VAT (if not reclaimed)</div></div>
      <div class="metric"><div class="v" id="m-rev">£0</div><div class="l">Annual Revenue (Year 2 steady)</div></div>
      <div class="metric"><div class="v" id="m-ebitda">£0</div><div class="l">EBITDA (Year 2 steady)</div></div>
      <div class="metric"><div class="v" id="m-dscr-y2">0.0x</div><div class="l">DSCR Year 2</div></div>
      <div class="metric"><div class="v" id="m-payback">0.0 yrs</div><div class="l">Payback on CAPEX</div></div>
    </div>

    <!-- 1. CAPEX (supplier quoted) -->
    <div class="section">
      <div class="section-header">
        <div class="section-title">1) Build Budget</div>
        <div class="pill">Supplier quoted</div>
      </div>
      <div class="section-content grid cols-3">
        <div class="stack">
          <label>Climbing fit out incl mezzanine and initial set (£)</label>
          <div class="input"><input id="capex-fitout" type="number" value="425000" step="5000" oninput="recalc()"></div>
          <div class="note">Quote window £400k to £450k excl VAT</div>
        </div>
        <div class="stack">
          <label>Initial holds purchase (£)</label>
          <div class="input"><input id="capex-holds" type="number" value="30000" step="1000" oninput="recalc()"></div>
          <div class="note">Supplier guidance £25k to £35k</div>
        </div>
        <div class="stack">
          <label>Training area and small gym kit (£)</label>
          <div class="input"><input id="capex-gym" type="number" value="30000" step="1000" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Branding and launch (£)</label>
          <div class="input"><input id="capex-brand" type="number" value="20000" step="1000" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Software and POS (£)</label>
          <div class="input"><input id="capex-pos" type="number" value="1500" step="100" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Licences and permits (£)</label>
          <div class="input"><input id="capex-lic" type="number" value="5000" step="500" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Contingency on build (%)</label>
          <div class="input"><input id="capex-cont-pct" type="number" value="7" step="1" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>VAT rate (%)</label>
          <div class="input"><input id="vat-rate" type="number" value="20" step="1" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>VAT reclaimable</label>
          <div class="input">
            <select id="vat-reclaim" onchange="recalc()">
              <option value="yes" selected>Yes</option>
              <option value="no">No</option>
            </select>
          </div>
        </div>
      </div>
      <div class="section-content">
        <table class="table">
          <thead><tr><th>Item</th><th>Amount</th></tr></thead>
          <tbody>
            <tr><td>Fit out incl mezzanine and initial set</td><td id="t-fitout" align="right">£0</td></tr>
            <tr><td>Initial holds</td><td id="t-holds" align="right">£0</td></tr>
            <tr><td>Training area and gym kit</td><td id="t-gym" align="right">£0</td></tr>
            <tr><td>Branding and launch</td><td id="t-brand" align="right">£0</td></tr>
            <tr><td>Software and POS</td><td id="t-pos" align="right">£0</td></tr>
            <tr><td>Licences and permits</td><td id="t-lic" align="right">£0</td></tr>
            <tr><td>Contingency</td><td id="t-cont" align="right">£0</td></tr>
            <tr><th>CAPEX ex VAT</th><th id="t-capex-ex">£0</th></tr>
            <tr><td>VAT</td><td id="t-vat">£0</td></tr>
            <tr><th>CAPEX incl VAT</th><th id="t-capex-inc">£0</th></tr>
          </tbody>
        </table>
        <p class="note">The model uses ex VAT for ROI if VAT is reclaimable. Toggle VAT above if the bank needs worst case.</p>
      </div>
    </div>

    <!-- 2. LEASE TERMS AND CORE OPEX -->
    <div class="section">
      <div class="section-header">
        <div class="section-title">2) Lease and Core Operating Costs</div>
        <div class="pill">Agreed terms</div>
      </div>
      <div class="section-content grid cols-3">
        <div class="stack">
          <label>Service charge (£ p.a.)</label>
          <div class="input"><input id="svc" type="number" value="57850" step="250" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Business rates payable (£ p.a.)</label>
          <div class="input"><input id="rates" type="number" value="35000" step="250" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Base rent nominal (£ p.a.)</label>
          <div class="input"><input id="rent-full" type="number" value="70000" step="1000" oninput="recalc()"></div>
          <div class="note">Lease: 10 years, break at 5, open market review end of year 5</div>
        </div>
      </div>
      <div class="section-content">
        <table class="table" id="rent-table">
          <thead>
            <tr>
              <th>Year</th><th>Rent (£)</th><th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Year 1</td><td><input id="r1" type="number" value="0" step="1000" oninput="recalc()"></td><td align="right">Rent free (9 months build/soft launch)</td></tr>
            <tr><td>Year 2</td><td><input id="r2" type="number" value="35000" step="1000" oninput="recalc()"></td><td align="right">Per landlord term</td></tr>
            <tr><td>Year 3</td><td><input id="r3" type="number" value="35000" step="1000" oninput="recalc()"></td><td align="right">Per landlord term</td></tr>
            <tr><td>Year 4</td><td><input id="r4" type="number" value="70000" step="1000" oninput="recalc()"></td><td align="right">Per landlord term</td></tr>
            <tr><td>Year 5</td><td><input id="r5" type="number" value="70000" step="1000" oninput="recalc()"></td><td align="right">Review to OMV after Year 5</td></tr>
          </tbody>
        </table>
      </div>
      <div class="section-content grid cols-3">
        <div class="stack"><label>Manager (£ p.a.)</label><div class="input"><input id="mgr" type="number" value="34000" step="500" oninput="recalc()"></div></div>
        <div class="stack"><label>Route setting (£ p.a.)</label><div class="input"><input id="rs" type="number" value="24000" step="500" oninput="recalc()"></div></div>
        <div class="stack"><label>Other staff (£ p.a.)</label><div class="input"><input id="staff" type="number" value="46000" step="1000" oninput="recalc()"></div></div>
        <div class="stack"><label>Utilities (£ p.a.)</label><div class="input"><input id="utils" type="number" value="23000" step="500" oninput="recalc()"></div></div>
        <div class="stack"><label>Insurance (£ p.a.)</label><div class="input"><input id="ins" type="number" value="3000" step="100" oninput="recalc()"></div></div>
        <div class="stack"><label>Marketing (£ p.a.)</label><div class="input"><input id="mkt" type="number" value="10000" step="500" oninput="recalc()"></div></div>
        <div class="stack"><label>Maintenance and holds refresh (£ p.a.)</label><div class="input"><input id="maint" type="number" value="9000" step="250" oninput="recalc()"></div></div>
      </div>
    </div>

    <!-- 3. COMMERCIALS -->
    <div class="section">
      <div class="section-header">
        <div class="section-title">3) Commercial Model</div>
        <div class="pill">Conservative vs competitors</div>
      </div>
      <div class="section-content grid cols-4">
        <div class="stack">
          <label>Members</label>
          <div class="input"><input id="m-qty" type="number" value="380" step="10" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Monthly membership price (£)</label>
          <div class="input"><input id="m-price" type="number" value="62" step="1" oninput="recalc()"></div>
          <div class="note">Local comps 60 to 75</div>
        </div>
        <div class="stack">
          <label>Day passes per month</label>
          <div class="input"><input id="dp-qty" type="number" value="500" step="10" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Day pass price (£)</label>
          <div class="input"><input id="dp-price" type="number" value="12" step="0.5" oninput="recalc()"></div>
        </div>

        <div class="stack">
          <label>Coaching sessions / month</label>
          <div class="input"><input id="coach-qty" type="number" value="30" step="1" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Coaching price (£)</label>
          <div class="input"><input id="coach-price" type="number" value="50" step="1" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Parties and youth / month</label>
          <div class="input"><input id="party-qty" type="number" value="9" step="1" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Party revenue each (£)</label>
          <div class="input"><input id="party-price" type="number" value="140" step="5" oninput="recalc()"></div>
        </div>

        <div class="stack">
          <label>Equipment rental net (£/month)</label>
          <div class="input"><input id="rent-net" type="number" value="600" step="50" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Retail net (£/month)</label>
          <div class="input"><input id="retail-net" type="number" value="900" step="50" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Cafe GMV (£/month)</label>
          <div class="input"><input id="cafe-gmv" type="number" value="3000" step="100" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Cafe net margin (%)</label>
          <div class="input"><input id="cafe-margin" type="number" value="7.5" step="0.5" oninput="recalc()"></div>
        </div>
      </div>
      <div class="section-content">
        <table class="table">
          <thead><tr><th>Revenue line</th><th>Annual</th></tr></thead>
          <tbody>
            <tr><td>Memberships</td><td id="rev-members">£0</td></tr>
            <tr><td>Day passes</td><td id="rev-daypass">£0</td></tr>
            <tr><td>Coaching and classes</td><td id="rev-coach">£0</td></tr>
            <tr><td>Parties and youth</td><td id="rev-party">£0</td></tr>
            <tr><td>Equipment rental (net)</td><td id="rev-rent">£0</td></tr>
            <tr><td>Retail (net)</td><td id="rev-retail">£0</td></tr>
            <tr><td>Cafe (net)</td><td id="rev-cafe">£0</td></tr>
            <tr><th>Total revenue</th><th id="rev-total">£0</th></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 4. LOAN STRUCTURE -->
    <div class="section">
      <div class="section-header">
        <div class="section-title">4) Loan Structure</div>
        <div class="pill">For bank</div>
      </div>
      <div class="section-content grid cols-3">
        <div class="stack">
          <label>Loan amount (£)</label>
          <div class="input"><input id="loan-amt" type="number" value="350000" step="5000" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Interest rate (% per annum)</label>
          <div class="input"><input id="loan-rate" type="number" value="7.5" step="0.1" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Amortisation term (years)</label>
          <div class="input"><input id="loan-term" type="number" value="6" step="1" oninput="recalc()"></div>
        </div>
        <div class="stack">
          <label>Interest-only months before amortisation</label>
          <div class="input"><input id="io-months" type="number" value="9" step="1" oninput="recalc()"></div>
          <div class="note">Matches rent-free and build period</div>
        </div>
        <div class="stack">
          <label>Use CAPEX incl VAT for loan sizing</label>
          <div class="input">
            <select id="loan-capex-mode" onchange="recalc()">
              <option value="ex" selected>Ex VAT basis</option>
              <option value="inc">Incl VAT basis</option>
            </select>
          </div>
        </div>
        <div class="stack">
          <label>One-off fees added to loan (£)</label>
          <div class="input"><input id="loan-fee" type="number" value="0" step="500" oninput="recalc()"></div>
        </div>
      </div>
      <div class="section-content">
        <table class="table">
          <thead><tr><th>Item</th><th>Amount</th></tr></thead>
          <tbody>
            <tr><td>Principal for amortisation</td><td id="loan-prin">£0</td></tr>
            <tr><td>Interest-only cost in Year 1</td><td id="loan-io-y1">£0</td></tr>
            <tr><td>Annual amortising payment (Years 2+)</td><td id="loan-pmt">£0</td></tr>
          </tbody>
        </table>
        <p class="note">Annual payment uses standard fixed-rate amortisation starting after the interest-only months.</p>
      </div>
    </div>

    <!-- 5. 5-YEAR P&L AND DSCR -->
    <div class="section">
      <div class="section-header">
        <div class="section-title">5) Five-year P&L and DSCR</div>
        <div class="pill">Auto from inputs</div>
      </div>
      <div class="section-content grid cols-3">
        <div class="stack"><label>Revenue growth Year 2 onward (%)</label><div class="input"><input id="g-rev" type="number" value="6" step="0.5" oninput="recalc()"></div></div>
        <div class="stack"><label>Opex growth Year 2 onward (%)</label><div class="input"><input id="g-opex" type="number" value="4" step="0.5" oninput="recalc()"></div></div>
        <div class="stack"><label>Use Year 2 as steady run-rate</label><div class="input"><select id="y2-steady" onchange="recalc()"><option value="yes" selected>Yes</option><option value="no">No</option></select></div></div>
      </div>
      <div class="section-content">
        <table class="table" id="pl-table">
          <thead>
            <tr>
              <th>Year</th>
              <th>Revenue</th>
              <th>Opex excl rent and rates</th>
              <th>Rent</th>
              <th>Service charge</th>
              <th>Business rates</th>
              <th>EBITDA</th>
              <th>Debt service</th>
              <th>DSCR</th>
            </tr>
          </thead>
          <tbody id="pl-body"></tbody>
        </table>
        <p class="note">DSCR = EBITDA divided by debt service. Banks typically want at least 1.25x on steady years.</p>
      </div>
    </div>

    <!-- SOURCES -->
    <div class="section">
      <div class="section-header"><div class="section-title">Sources and calculation notes</div></div>
      <div class="section-content">
        <ul class="note">
          <li>Build costs: supplier quotes on file. Fit out incl mezzanine and initial set 400k to 450k. Model default 425k.</li>
          <li>Initial holds: supplier guidance 25k to 35k. Model default 30k.</li>
          <li>Lease: 10 years outside LTA, break at year 5, rent free year 1, stepped rent years 2 to 5, review to open market after year 5. Service charge 57,850. Business rates c. 35,000.</li>
          <li>Pricing: benchmarked vs nearby bouldering gyms. Model uses conservative price points to remain competitive.</li>
          <li>Cafe net is GMV times net margin. Retail and rental are net of cost of sales.</li>
          <li>Amortisation uses standard PMT on annual basis after interest-only months. Interest-only cost in year 1 is simple interest on outstanding principal for the IO period.</li>
        </ul>
        <div class="foot">Export to CSV: press <span class="kbd">E</span> on your keyboard. You will get a downloadable CSV with 5-year lines.</div>
      </div>
    </div>
  </div>
</div>

<script>
  function N(v,d=0){const x=parseFloat(v);return isFinite(x)?x:d;}
  function £(v){const r=Math.round(v);return (r<0?'-£':'£')+Math.abs(r).toLocaleString();}
  function pct(v){return (isFinite(v)?v:0).toFixed(1)+'%';}

  const S = {
    conservative: {
      mQty:380, mPrice:62, dpQty:500, dpPrice:12,
      coachQty:30, coachPrice:50, partyQty:9, partyPrice:140,
      rentNet:600, retailNet:900, cafeGMV:3000, cafeMargin:7.5,
      mgr:34000, rs:24000, staff:46000, utils:23000, ins:3000, mkt:10000, maint:9000
    },
    realistic: {
      mQty:450, mPrice:65, dpQty:600, dpPrice:13,
      coachQty:40, coachPrice:55, partyQty:12, partyPrice:150,
      rentNet:800, retailNet:1200, cafeGMV:4000, cafeMargin:8.0,
      mgr:36000, rs:26000, staff:50000, utils:24000, ins:3000, mkt:12000, maint:10000
    },
    optimistic: {
      mQty:520, mPrice:70, dpQty:750, dpPrice:14,
      coachQty:60, coachPrice:60, partyQty:16, partyPrice:160,
      rentNet:1200, retailNet:1800, cafeGMV:6000, cafeMargin:9.0,
      mgr:38000, rs:30000, staff:60000, utils:27000, ins:3200, mkt:15000, maint:12000
    }
  };

  function applyScenario(name){
    const s = S[name];
    document.querySelectorAll('.btn').forEach(b=>b.classList.toggle('active', b.dataset.s===name));
    document.getElementById('scenario-pill').textContent = name.charAt(0).toUpperCase()+name.slice(1);

    // commercials
    document.getElementById('m-qty').value = s.mQty;
    document.getElementById('m-price').value = s.mPrice;
    document.getElementById('dp-qty').value = s.dpQty;
    document.getElementById('dp-price').value = s.dpPrice;
    document.getElementById('coach-qty').value = s.coachQty;
    document.getElementById('coach-price').value = s.coachPrice;
    document.getElementById('party-qty').value = s.partyQty;
    document.getElementById('party-price').value = s.partyPrice;
    document.getElementById('rent-net').value = s.rentNet;
    document.getElementById('retail-net').value = s.retailNet;
    document.getElementById('cafe-gmv').value = s.cafeGMV;
    document.getElementById('cafe-margin').value = s.cafeMargin;

    // opex
    document.getElementById('mgr').value = s.mgr;
    document.getElementById('rs').value = s.rs;
    document.getElementById('staff').value = s.staff;
    document.getElementById('utils').value = s.utils;
    document.getElementById('ins').value = s.ins;
    document.getElementById('mkt').value = s.mkt;
    document.getElementById('maint').value = s.maint;

    recalc();
  }

  function PMT(rate, nper, pv){
    if(rate===0) return pv / nper;
    const r = rate;
    return pv * r / (1 - Math.pow(1+r, -nper));
  }

  function recalc(){
    // CAPEX
    const fit = N(document.getElementById('capex-fitout').value);
    const holds = N(document.getElementById('capex-holds').value);
    const gym = N(document.getElementById('capex-gym').value);
    const brand = N(document.getElementById('capex-brand').value);
    const pos = N(document.getElementById('capex-pos').value);
    const lic = N(document.getElementById('capex-lic').value);
    const contPct = N(document.getElementById('capex-cont-pct').value)/100;
    const vatPct = N(document.getElementById('vat-rate').value)/100;
    const vatReclaim = document.getElementById('vat-reclaim').value === 'yes';

    const capexBase = fit + holds + gym + brand + pos + lic;
    const cont = capexBase * contPct;
    const capexEx = capexBase + cont;
    const vat = capexEx * vatPct;
    const capexInc = capexEx + vat;
    const capexRoiBasis = vatReclaim ? capexEx : capexInc;

    // CAPEX UI
    document.getElementById('t-fitout').textContent = £(fit);
    document.getElementById('t-holds').textContent = £(holds);
    document.getElementById('t-gym').textContent = £(gym);
    document.getElementById('t-brand').textContent = £(brand);
    document.getElementById('t-pos').textContent = £(pos);
    document.getElementById('t-lic').textContent = £(lic);
    document.getElementById('t-cont').textContent = £(cont);
    document.getElementById('t-capex-ex').textContent = £(capexEx);
    document.getElementById('t-vat').textContent = £(vat);
    document.getElementById('t-capex-inc').textContent = £(capexInc);
    document.getElementById('m-capex-ex').textContent = £(capexEx);
    document.getElementById('m-capex-inc').textContent = £(capexInc);

    // OPEX fixed
    const svc = N(document.getElementById('svc').value);
    const rates = N(document.getElementById('rates').value);
    const mgr = N(document.getElementById('mgr').value);
    const rs = N(document.getElementById('rs').value);
    const staff = N(document.getElementById('staff').value);
    const utils = N(document.getElementById('utils').value);
    const ins = N(document.getElementById('ins').value);
    const mkt = N(document.getElementById('mkt').value);
    const maint = N(document.getElementById('maint').value);

    const opexExRentRates = mgr + rs + staff + utils + ins + mkt + maint + svc;

    // Rent schedule
    const rent = [
      N(document.getElementById('r1').value),
      N(document.getElementById('r2').value),
      N(document.getElementById('r3').value),
      N(document.getElementById('r4').value),
      N(document.getElementById('r5').value)
    ];

    // Commercials to annual
    const mQty = N(document.getElementById('m-qty').value);
    const mPrice = N(document.getElementById('m-price').value);
    const dpQty = N(document.getElementById('dp-qty').value);
    const dpPrice = N(document.getElementById('dp-price').value);
    const coachQty = N(document.getElementById('coach-qty').value);
    const coachPrice = N(document.getElementById('coach-price').value);
    const partyQty = N(document.getElementById('party-qty').value);
    const partyPrice = N(document.getElementById('party-price').value);
    const rentNet = N(document.getElementById('rent-net').value);
    const retailNet = N(document.getElementById('retail-net').value);
    const cafeGMV = N(document.getElementById('cafe-gmv').value);
    const cafeMargin = N(document.getElementById('cafe-margin').value)/100;

    const revMembers = mQty * mPrice * 12;
    const revDayPass = dpQty * dpPrice * 12;
    const revCoach = coachQty * coachPrice * 12;
    const revParty = partyQty * partyPrice * 12;
    const revRent = rentNet * 12;
    const revRetail = retailNet * 12;
    const revCafe = cafeGMV * cafeMargin * 12;

    const revTotalY2 = revMembers + revDayPass + revCoach + revParty + revRent + revRetail + revCafe;

    // loan
    const loanAmt = N(document.getElementById('loan-amt').value);
    const loanFee = N(document.getElementById('loan-fee').value);
    const loanRate = N(document.getElementById('loan-rate').value)/100;
    const loanTerm = Math.max(1, N(document.getElementById('loan-term').value));
    const ioMonths = Math.max(0, N(document.getElementById('io-months').value));
    const useCapex = document.getElementById('loan-capex-mode').value;
    const capexForLoan = useCapex==='inc' ? capexInc : capexEx;

    // principal used for PMT
    const principal = Math.max(loanAmt + loanFee, 0);
    const annualRate = loanRate;
    const pmt = PMT(annualRate, loanTerm, principal);
    const ioCostY1 = principal * annualRate * (ioMonths/12);

    document.getElementById('loan-prin').textContent = £(principal);
    document.getElementById('loan-io-y1').textContent = £(ioCostY1);
    document.getElementById('loan-pmt').textContent = £(pmt);

    // 5 year P&L
    const gRev = N(document.getElementById('g-rev').value)/100;
    const gOpex = N(document.getElementById('g-opex').value)/100;
    const y2Steady = document.getElementById('y2-steady').value === 'yes';

    const tbody = document.getElementById('pl-body');
    tbody.innerHTML = '';

    let rev = revTotalY2; // treat as Year 2 steady in default
    let opex = opexExRentRates;
    let dscrY2 = 0;
    let ebitdaY2 = 0;

    for(let y=1; y<=5; y++){
      // Year 1 ramp. Use 70% of steady by default, then grow into Y2
      let revY = (y===1 ? rev * 0.7 : (y===2 ? rev : rev = rev * (1+gRev)));
      // Opex ramp in Y1 at 95% of steady to reflect partial year ops
      let opexY = (y===1 ? opex * 0.95 : (y===2 ? opex : opex = opex * (1+gOpex)));

      // Debt service stream
      const debtY = (y===1 ? ioCostY1 : pmt);

      const ebitda = revY - (opexY + rent[y-1] + rates);
      const dscr = debtY>0 ? (ebitda / debtY) : 999;

      if(y===2){ dscrY2 = dscr; ebitdaY2 = ebitda; }

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>Year ${y}</td>
        <td>${£(revY)}</td>
        <td>${£(opexY)}</td>
        <td>${£(rent[y-1])}</td>
        <td>${£(svc)}</td>
        <td>${£(rates)}</td>
        <td ${ebitda>=0?'class="good"':'class="warn"'}>${£(ebitda)}</td>
        <td>${£(debtY)}</td>
        <td ${dscr>=1.25?'class="good"':'class="warn"'}>${isFinite(dscr)?dscr.toFixed(2)+'x':'—'}</td>
      `;
      tbody.appendChild(tr);

      // If using Year 2 as steady, do not compound after Y2 unless specified
      if(y2Steady && y>=2){ rev = revTotalY2; opex = opexExRentRates; }
    }

    // KPIs
    document.getElementById('m-rev').textContent = £(revTotalY2);
    document.getElementById('m-ebitda').textContent = £(ebitdaY2);
    document.getElementById('m-dscr-y2').textContent = isFinite(dscrY2)? dscrY2.toFixed(2)+'x' : '—';

    const payback = ebitdaY2>0 ? (capexRoiBasis / ebitdaY2) : 0;
    document.getElementById('m-payback').textContent = ebitdaY2>0 ? payback.toFixed(1)+' yrs' : 'N/A';

    // Revenue table UI
    document.getElementById('rev-members').textContent = £(revMembers);
    document.getElementById('rev-daypass').textContent = £(revDayPass);
    document.getElementById('rev-coach').textContent = £(revCoach);
    document.getElementById('rev-party').textContent = £(revParty);
    document.getElementById('rev-rent').textContent = £(revRent);
    document.getElementById('rev-retail').textContent = £(revRetail);
    document.getElementById('rev-cafe').textContent = £(revCafe);
    document.getElementById('rev-total').textContent = £(revTotalY2);
  }

  // CSV export
  function exportCSV(){
    // Build a flat 5-year CSV from current table plus assumptions
    const rows = [];
    const get = id => document.getElementById(id).value;

    // header
    rows.push(['Section','Field','Value']);

    // capex
    rows.push(['CAPEX','Fit out incl mezz and initial set', get('capex-fitout')]);
    rows.push(['CAPEX','Initial holds', get('capex-holds')]);
    rows.push(['CAPEX','Training kit', get('capex-gym')]);
    rows.push(['CAPEX','Branding and launch', get('capex-brand')]);
    rows.push(['CAPEX','Software and POS', get('capex-pos')]);
    rows.push(['CAPEX','Licences and permits', get('capex-lic')]);
    rows.push(['CAPEX','Contingency %', get('capex-cont-pct')]);
    rows.push(['CAPEX','VAT %', get('vat-rate')]);
    rows.push(['CAPEX','VAT reclaimable', document.getElementById('vat-reclaim').value]);

    // lease
    rows.push(['Lease','Service charge', get('svc')]);
    rows.push(['Lease','Business rates', get('rates')]);
    rows.push(['Lease','Year 1 rent', get('r1')]);
    rows.push(['Lease','Year 2 rent', get('r2')]);
    rows.push(['Lease','Year 3 rent', get('r3')]);
    rows.push(['Lease','Year 4 rent', get('r4')]);
    rows.push(['Lease','Year 5 rent', get('r5')]);

    // commercials
    rows.push(['Commercials','Members', get('m-qty')]);
    rows.push(['Commercials','Membership price', get('m-price')]);
    rows.push(['Commercials','Day passes / month', get('dp-qty')]);
    rows.push(['Commercials','Day pass price', get('dp-price')]);
    rows.push(['Commercials','Coaching / month', get('coach-qty')]);
    rows.push(['Commercials','Coaching price', get('coach-price')]);
    rows.push(['Commercials','Parties / month', get('party-qty')]);
    rows.push(['Commercials','Party price', get('party-price')]);
    rows.push(['Commercials','Equipment rental net / month', get('rent-net')]);
    rows.push(['Commercials','Retail net / month', get('retail-net')]);
    rows.push(['Commercials','Cafe GMV / month', get('cafe-gmv')]);
    rows.push(['Commercials','Cafe margin %', get('cafe-margin')]);

    // loan
    rows.push(['Loan','Amount', get('loan-amt')]);
    rows.push(['Loan','Rate %', get('loan-rate')]);
    rows.push(['Loan','Term years', get('loan-term')]);
    rows.push(['Loan','Interest-only months', get('io-months')]);
    rows.push(['Loan','Capex basis', document.getElementById('loan-capex-mode').value]);
    rows.push(['Loan','Fees added', get('loan-fee')]);

    // P&L from table
    const pl = document.querySelectorAll('#pl-body tr');
    rows.push([]);
    rows.push(['P&L','Year','Revenue','Opex excl rent and rates','Rent','Service charge','Business rates','EBITDA','Debt service','DSCR']);
    pl.forEach(tr=>{
      const tds = Array.from(tr.children).map(td=>td.textContent.replace(/,/g,''));
      rows.push(['P&L', tds[0], tds[1], tds[2], tds[3], tds[4], tds[5], tds[6], tds[7], tds[8]]);
    });

    const csv = rows.map(r=>r.join(',')).join('\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'queensgate_bouldering_bank_model.csv';
    a.click();
    URL.revokeObjectURL(a.href);
  }

  // listeners
  document.querySelectorAll('.btn').forEach(b=>{
    b.addEventListener('click', ()=>applyScenario(b.dataset.s));
  });
  window.addEventListener('load', ()=>{ applyScenario('conservative'); });
  window.addEventListener('keydown', e=>{
    if(e.key.toLowerCase()==='e'){ exportCSV(); }
  });
</script>
</body>
</html>

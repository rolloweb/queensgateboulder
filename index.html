<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Queensgate Bouldering Centre â€“ Financial Model</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    background:#f5f7fa;color:#1f2933;padding:20px;
  }
  .container{
    max-width:1200px;margin:0 auto;background:#fff;border-radius:12px;
    box-shadow:0 2px 12px rgba(0,0,0,.1);padding:24px;
  }
  .key-metrics{
    display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:16px;margin-bottom:24px;padding:16px;background:#f9fafb;border-radius:12px;
  }
  .metric-value{font-size:1.6rem;font-weight:800}
  .rev{color:#4f46e5} .cap{color:#d97706} .opex{color:#0ea5e9} .ebit{color:#16a34a}
  table{width:100%;border-collapse:collapse;margin-top:16px}
  th,td{border-bottom:1px solid #e5e7eb;padding:10px 6px;font-size:.9rem}
  .num{text-align:right}
  input{width:120px;text-align:right;padding:6px;border:1px solid #cbd5e1;border-radius:6px;}
  .yearBtn.active{background:#6366f1;color:#fff;border-color:#6366f1;}
  .yearBtn{padding:8px 16px;border-radius:20px;border:1px solid #d1d5db;background:#e5e7eb;cursor:pointer;}
</style>
</head>

<body>
<div class="container">

  <div style="margin-bottom:20px">
    <button class="yearBtn active" data-year="1">Year 1</button>
    <button class="yearBtn" data-year="2">Year 2</button>
  </div>

  <div class="key-metrics">
    <div>
      <div>Revenue Total</div>
      <div id="revTotal" class="metric-value rev">&pound;0</div>
    </div>
    <div>
      <div>CAPEX Total</div>
      <div id="capexTotal" class="metric-value cap">&pound;0</div>
    </div>
    <div>
      <div>OPEX Total</div>
      <div id="opexTotal" class="metric-value opex">&pound;0</div>
    </div>
    <div>
      <div>Annual profit EBITDA</div>
      <div id="ebitda" class="metric-value ebit">&pound;0</div>
    </div>
  </div>

  <h2>CAPEX Breakdown</h2>
  <table id="capexTable"><thead><tr><th>Item</th><th class="num">Value</th></tr></thead><tbody></tbody></table>

  <h2>Finance Options</h2>
  <table>
    <tr><th>Capital Cost</th><td class="num">&pound;300000</td></tr>
    <tr><th>Deposit 10%</th><td class="num">&pound;30000</td></tr>
    <tr><th>Balance to Finance</th><td class="num">&pound;270000</td></tr>
  </table>

  <h3>Repayment Scenarios</h3>
  <table>
    <tr><th>36 months</th><td class="num">&pound;10107.55 monthly</td></tr>
    <tr><th>48 months</th><td class="num">&pound;8180.40 monthly</td></tr>
    <tr><th>60 months</th><td class="num">&pound;7045.71 monthly</td></tr>
  </table>

  <h2>OPEX Breakdown</h2>
  <table id="opexTable"><thead><tr><th>Item</th><th class="num">Value</th></tr></thead><tbody></tbody></table>

</div>

<script>
const CSV_PATH = "./queensgate_bouldering_model_v2.csv";

let rows = [];
let currentYear = 1;

function money(n){
  return "&pound;" + Number(n).toLocaleString("en-GB");
}

function loadCsv(){
  Papa.parse(CSV_PATH,{
    download:true,
    header:true,
    complete: res=>{
      rows = res.data.map(r=>({
        section: r.SECTION,
        desc: r.DESCRIPTION,
        y1: Number(r.YEAR1),
        y2: Number(r.YEAR2)
      }));
      render();
    }
  });
}

function getVal(r){
  return currentYear === 1 ? r.y1 : r.y2;
}

function totals(){
  let rev=0, cap=0, op=0;

  rows.forEach(r=>{
    const v = getVal(r);
    if(r.section==="REVENUE") rev += v;
    if(r.section==="CAPEX") cap += v;
    if(r.section==="OPEX") op += v;
  });

  return {rev,cap,op};
}

function fillTable(section, tableId){
  const tbody = document.querySelector("#"+tableId+" tbody");
  tbody.innerHTML = "";

  rows.filter(r=>r.section===section).forEach(r=>{
    const v = getVal(r);

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.desc.replace(/_/g," ")}</td>
      <td class="num">
        <input data-desc="${r.desc}" value="${v}">
      </td>`;
    tbody.appendChild(tr);
  });

  tbody.querySelectorAll("input").forEach(inp=>{
    inp.addEventListener("input",e=>{
      const row = rows.find(r=>r.desc===e.target.dataset.desc);
      const v = Number(e.target.value || 0);
      if(currentYear===1) row.y1 = v; else row.y2 = v;
      render();
    });
  });
}

function render(){
  const {rev,cap,op} = totals();
  const ebit = rev - op;

  document.getElementById("revTotal").innerHTML = money(rev);
  document.getElementById("capexTotal").innerHTML = money(cap);
  document.getElementById("opexTotal").innerHTML = money(op);
  document.getElementById("ebitda").innerHTML = money(ebit);

  fillTable("CAPEX","capexTable");
  fillTable("OPEX","opexTable");
}

document.querySelectorAll(".yearBtn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".yearBtn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentYear = Number(btn.dataset.year);
    render();
  });
});

loadCsv();
</script>

</body>
</html>

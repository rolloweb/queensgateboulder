<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Queensgate Bouldering Centre Financial Model</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    background:#f5f7fa;color:#1f2933;padding:20px;
  }
  .container{
    max-width:1200px;margin:0 auto;background:#fff;
    border-radius:12px;overflow:hidden;
    box-shadow:0 2px 12px rgba(0,0,0,.1);
    padding:20px 24px;
  }
  h2{margin:20px 0 10px;font-size:1.4rem;font-weight:700;}

  .top-metrics{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
    gap:18px;
    margin-bottom:26px;
  }
  .metric-box{
    background:#f9fafb;border:1px solid #e5e7eb;border-radius:10px;
    padding:16px;
  }
  .metric-label{font-size:.8rem;color:#6b7280;}
  .metric-value{font-size:1.8rem;font-weight:800;margin-top:6px;}

  .rev{color:#4f46e5;}
  .cap{color:#d97706;}
  .opex{color:#0ea5e9;}
  .ebit{color:#059669;}

  .toggle{
    display:flex;gap:10px;margin-bottom:20px;
  }
  .toggle button{
    padding:8px 18px;border-radius:20px;border:1px solid #d1d5db;
    background:#e5e7eb;color:#374151;font-weight:600;cursor:pointer;
  }
  .toggle button.active{
    background:#6366f1;color:#fff;border-color:#6366f1;
  }

  table{width:100%;border-collapse:collapse;margin-top:12px;}
  th,td{padding:10px 8px;border-bottom:1px solid #e5e7eb;font-size:.9rem;}
  th{text-align:left;color:#6b7280;font-size:.75rem;text-transform:uppercase;}
  .num{text-align:right;}
  input{
    width:120px;text-align:right;
    padding:6px 8px;border:1px solid #cbd5e1;border-radius:6px;
  }
</style>
</head>

<body>
<div class="container">

  <div class="toggle">
    <button class="yearBtn active" data-year="1">Year 1</button>
    <button class="yearBtn" data-year="2">Year 2</button>
  </div>

  <div class="top-metrics">
    <div class="metric-box">
      <div class="metric-label">Revenue Total</div>
      <div id="revTotal" class="metric-value rev">£0</div>
    </div>

    <div class="metric-box">
      <div class="metric-label">CAPEX Total</div>
      <div id="capexTotal" class="metric-value cap">£0</div>
    </div>

    <div class="metric-box">
      <div class="metric-label">OPEX Total</div>
      <div id="opexTotal" class="metric-value opex">£0</div>
    </div>

    <div class="metric-box">
      <div class="metric-label">Annual Profit EBITDA</div>
      <div id="ebitda" class="metric-value ebit">£0</div>
    </div>
  </div>

  <!-- CAPEX SECTION -->
  <h2>CAPEX Breakdown</h2>
  <table id="capexTable">
    <thead>
      <tr><th>Item</th><th class="num">Value</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- LOAN SECTION -->
  <h2>Finance Options</h2>
  <table>
    <tr><th>Capital Cost</th><td class="num">£300000</td></tr>
    <tr><th>Deposit Required</th><td class="num">£30000</td></tr>
    <tr><th>Balance to Finance</th><td class="num">£270000</td></tr>
  </table>

  <h3 style="margin:12px 0 4px">Repayment Scenarios</h3>
  <table>
    <tr><th>Term 36 months</th><td class="num">£10107.55 monthly</td></tr>
    <tr><th>Term 48 months</th><td class="num">£8180.40 monthly</td></tr>
    <tr><th>Term 60 months</th><td class="num">£7045.71 monthly</td></tr>
  </table>

  <!-- OPEX SECTION -->
  <h2>OPEX Breakdown</h2>
  <table id="opexTable">
    <thead>
      <tr><th>Item</th><th class="num">Value</th></tr>
    </thead>
    <tbody></tbody>
  </table>

</div>

<script>
const CSV_PATH = "./queensgate_bouldering_model_v2.csv";

let rows = [];
let currentYear = 1;

function money(n){return "£" + Number(n).toLocaleString("en-GB");}

function load(){
  Papa.parse(CSV_PATH,{
    download:true,
    header:true,
    complete: res=>{
      rows = res.data;
      rows.forEach(r=>{
        r.Y1 = Number(r.YEAR1||0);
        r.Y2 = Number(r.YEAR2||0);
      });
      render();
    }
  });
}

function getValue(r){
  if(r.SECTION==="CAPEX" && currentYear===2) return 0;
  return currentYear===1 ? r.Y1 : r.Y2;
}

function totals(){
  let rev=0,cap=0,op=0;
  rows.forEach(r=>{
    const v = getValue(r);
    if(r.SECTION==="REVENUE") rev += v;
    if(r.SECTION==="CAPEX") cap += v;
    if(r.SECTION==="OPEX") op += v;
  });
  return {rev,cap,op,ebit:rev-op};
}

function render(){
  const {rev,cap,op,ebit} = totals();
  document.getElementById("revTotal").textContent = money(rev);
  document.getElementById("capexTotal").textContent = money(cap);
  document.getElementById("opexTotal").textContent = money(op);
  document.getElementById("ebitda").textContent = money(ebit);

  fillTable("capexTable","CAPEX");
  fillTable("opexTable","OPEX");
}

function fillTable(id,section){
  const tb = document.querySelector("#"+id+" tbody");
  tb.innerHTML="";
  rows.filter(r=>r.SECTION===section).forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${r.DESCRIPTION}</td>
      <td class="num"><input type="number" value="${getValue(r)}" data-desc="${r.DESCRIPTION}" /></td>
    `;
    tb.appendChild(tr);
  });

  tb.querySelectorAll("input").forEach(inp=>{
    inp.addEventListener("input",e=>{
      const desc=e.target.dataset.desc;
      const row = rows.find(r=>r.DESCRIPTION===desc);
      const val=Number(e.target.value||0);
      if(currentYear===1) row.Y1 = val; else row.Y2 = val;
      render();
    });
  });
}

document.querySelectorAll(".yearBtn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".yearBtn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentYear = Number(btn.dataset.year);
    render();
  });
});

load();
</script>

</body>
</html>

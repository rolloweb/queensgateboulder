<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Queensgate Bouldering — Financial Model</title>
  <style>
    :root {
      --bg:#0f172a; /* slate-900 */
      --card:#111827; /* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --text:#e5e7eb; /* gray-200 */
      --accent:#38bdf8; /* sky-400 */
      --accent2:#a78bfa; /* violet-400 */
      --good:#34d399; /* emerald-400 */
      --warn:#fbbf24; /* amber-400 */
      --bad:#f87171; /* red-400 */
      --grid-gap:16px;
      --radius:16px;
    }
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:radial-gradient(1200px 1200px at 10% -10%, #1f2937 0%, var(--bg) 40%), linear-gradient(180deg, #0b1226, var(--bg));
      color:var(--text);
    }
    h1,h2,h3{margin:0 0 8px 0}
    h1{font-size:28px; letter-spacing:0.2px}
    h2{font-size:18px; color:#cbd5e1}
    .wrap{
      max-width:1200px; margin:24px auto; padding:0 16px 48px;
    }
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:16px;
    }
    .pill{background:rgba(56,189,248,.15); color:#e0f2fe; border:1px solid rgba(56,189,248,.35); padding:6px 10px; border-radius:999px; font-size:12px}
    .grid{display:grid; grid-template-columns: 360px 1fr; gap:var(--grid-gap)}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:16px; box-shadow:0 2px 10px rgba(0,0,0,.25)}
    .card h3{font-size:15px; color:#c7d2fe; margin-bottom:6px}
    .sub{font-size:12px; color:var(--muted)}
    .input-row{display:grid; grid-template-columns: 1fr 100px; gap:8px; align-items:center; margin:6px 0}
    .input-row label{font-size:13px; color:#cbd5e1}
    .input-row input{width:100%; padding:8px 10px; border-radius:10px; background:#0b1220; color:var(--text); border:1px solid #1f2a44; font-size:13px}
    .input-row input:focus{outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,.2)}
    .section{margin-top:10px; padding-top:10px; border-top:1px dashed rgba(255,255,255,.08)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .kpis{display:grid; grid-template-columns: repeat(4, 1fr); gap:10px}
    @media (max-width: 980px){.kpis{grid-template-columns: repeat(2,1fr)}}
    .kpi{background:#0b1220; border:1px solid #1f2a44; border-radius:14px; padding:12px}
    .kpi .label{font-size:12px; color:#9ca3af}
    .kpi .value{font-size:20px; margin-top:6px}
    .kpi.good .value{color:var(--good)}
    .kpi.warn .value{color:var(--warn)}
    .kpi.bad .value{color:var(--bad)}
    .flex{display:flex; gap:10px}
    .btn{cursor:pointer; background:linear-gradient(180deg, #1e293b, #0f172a); border:1px solid #24324a; color:#e5e7eb; padding:8px 12px; border-radius:12px; font-size:13px}
    .btn.primary{background:linear-gradient(180deg, #2563eb, #1d4ed8); border-color:#1d4ed8}
    .btn.ghost{background:transparent; border-color:#334155}
    .toolbar{display:flex; gap:8px; align-items:center}
    .table{width:100%; border-collapse:separate; border-spacing:0}
    .table th,.table td{padding:10px 12px; text-align:right; border-bottom:1px solid rgba(255,255,255,.06); font-size:13px}
    .table th:first-child,.table td:first-child{text-align:left}
    .table tr:hover td{background:rgba(255,255,255,.02)}
    .badge{font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.15); color:#cbd5e1}
    .chart{height:220px; position:relative; background:#0b1220; border:1px solid #1f2a44; border-radius:14px; overflow:hidden}
    .chart .bar{position:absolute; bottom:0; width:20%; border-radius:6px 6px 0 0; background:linear-gradient(180deg, var(--accent), #2563eb)}
    .legend{display:flex; gap:12px; font-size:12px; color:#cbd5e1; margin-top:6px; align-items:center; flex-wrap:wrap}
    .legend > span{display:inline-flex; gap:6px; align-items:center}
    .dot{width:10px; height:10px; border-radius:2px; display:inline-block}
    .dot.rev{background:#38bdf8}
    .dot.cogs{background:#fb7185}
    .dot.opex{background:#f59e0b}
    .dot.ebitda{background:#34d399}
    .foot{margin-top:8px; font-size:11px; color:#94a3b8}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>Queensgate Bouldering — Financial Model</h1>
        <div class="sub">Investor and bank view with five year projections, DSCR, and break even</div>
      </div>
      <div class="toolbar">
        <button class="btn ghost" id="btnReset">Reset</button>
        <button class="btn primary" id="btnExport">Export CSV</button>
      </div>
    </div>

    <div class="grid">
      <!-- INPUTS PANEL -->
      <div class="card" id="inputsCard">
        <h3>Inputs</h3>
        <div class="sub">Enter monthly values unless stated</div>

        <div class="section">
          <div class="pill">Pricing and demand</div>
          <div class="input-row"><label>Members at start</label><input id="members_start" type="number" value="650" /></div>
          <div class="input-row"><label>Net new members per month</label><input id="members_net_new" type="number" value="30" /></div>
          <div class="input-row"><label>Monthly churn percent</label><input id="churn_pct" type="number" value="5" /></div>
          <div class="input-row"><label>Membership price per month £</label><input id="m_price" type="number" value="45" /></div>
          <div class="input-row"><label>Day pass visits per month</label><input id="visits" type="number" value="3200" /></div>
          <div class="input-row"><label>Day pass price £</label><input id="d_price" type="number" value="12" /></div>
          <div class="input-row"><label>Retail per visit £</label><input id="retail_per_visit" type="number" value="2.5" /></div>
          <div class="input-row"><label>Coaching revenue per month £</label><input id="coach_rev" type="number" value="6000" /></div>
        </div>

        <div class="section">
          <div class="pill">Operating costs</div>
          <div class="input-row"><label>Rent £</label><input id="rent" type="number" value="5800" /></div>
          <div class="input-row"><label>Business rates £</label><input id="rates" type="number" value="4000" /></div>
          <div class="input-row"><label>Service charge £</label><input id="service_charge" type="number" value="1500" /></div>
          <div class="input-row"><label>Utilities £</label><input id="utilities" type="number" value="3500" /></div>
          <div class="input-row"><label>Staff salaries £</label><input id="staff" type="number" value="28000" /></div>
          <div class="input-row"><label>Insurance £</label><input id="insurance" type="number" value="600" /></div>
          <div class="input-row"><label>Marketing £</label><input id="marketing" type="number" value="3000" /></div>
          <div class="input-row"><label>Maintenance £</label><input id="maintenance" type="number" value="1200" /></div>
          <div class="input-row"><label>Other opex £</label><input id="other_opex" type="number" value="800" /></div>
          <div class="input-row"><label>COGS percent retail"</label><input id="cogs_pct" type="number" value="35" /></div>
        </div>

        <div class="section">
          <div class="pill">Capex one off</div>
          <div class="input-row"><label>Walls and matting £</label><input id="capex_walls" type="number" value="420000" /></div>
          <div class="input-row"><label>Fit out and MEP £</label><input id="capex_fitout" type="number" value="60000" /></div>
          <div class="input-row"><label>Holds and volumes £</label><input id="capex_holds" type="number" value="30000" /></div>
          <div class="input-row"><label>Equipment and POS £</label><input id="capex_equipment" type="number" value="15000" /></div>
          <div class="input-row"><label>Working capital £</label><input id="capex_wc" type="number" value="20000" /></div>
          <div class="input-row"><label>Contingency £</label><input id="capex_cont" type="number" value="25000" /></div>
        </div>

        <div class="section">
          <div class="pill">Financing</div>
          <div class="input-row"><label>Owner equity £</label><input id="equity" type="number" value="230000" /></div>
          <div class="input-row"><label>Bank loan £</label><input id="loan_amt" type="number" value="250000" /></div>
          <div class="input-row"><label>Interest rate percent annual</label><input id="loan_rate" type="number" value="8" /></div>
          <div class="input-row"><label>Loan term years</label><input id="loan_years" type="number" value="7" /></div>
          <div class="input-row"><label>Interest only months</label><input id="io_months" type="number" value="6" /></div>
        </div>

        <div class="section">
          <div class="pill">Growth and inflation per year</div>
          <div class="input-row"><label>Member price growth percent</label><input id="price_growth" type="number" value="3" /></div>
          <div class="input-row"><label>Visits growth percent</label><input id="visit_growth" type="number" value="5" /></div>
          <div class="input-row"><label>Opex inflation percent</label><input id="opex_infl" type="number" value="4" /></div>
        </div>
      </div>

      <!-- OUTPUTS PANEL -->
      <div class="card">
        <div class="kpis" id="kpis">
          <div class="kpi"><div class="label">Year 1 revenue</div><div class="value" id="kpi_rev">£0</div></div>
          <div class="kpi"><div class="label">Year 1 EBITDA</div><div class="value" id="kpi_ebitda">£0</div></div>
          <div class="kpi" id="kpi_dscr_box"><div class="label">DSCR Year 2</div><div class="value" id="kpi_dscr">0.00</div></div>
          <div class="kpi"><div class="label">Breakeven visits per day</div><div class="value" id="kpi_breakeven">0</div></div>
        </div>

        <div class="row section">
          <div class="card">
            <h3>Year 1 summary</h3>
            <table class="table" id="summaryY1"></table>
            <div class="legend"><span><i class="dot rev"></i>Revenue</span><span><i class="dot cogs"></i>COGS</span><span><i class="dot opex"></i>Opex</span><span><i class="dot ebitda"></i>EBITDA</span></div>
            <div class="chart" id="chartBars"></div>
          </div>
          <div class="card">
            <h3>Five year projection</h3>
            <table class="table" id="proj"></table>
          </div>
        </div>

        <div class="row section">
          <div class="card">
            <h3>Debt schedule first 24 months</h3>
            <table class="table" id="debt"></table>
          </div>
          <div class="card">
            <h3>Assumptions check</h3>
            <div class="sub">Quick view for investment committee</div>
            <table class="table" id="assump"></table>
            <div class="foot">Edit inputs on the left to update all tables and KPIs</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const £ = n => new Intl.NumberFormat('en-GB', {style:'currency', currency:'GBP', maximumFractionDigits:0}).format(n||0);
    const pct = n => (n||0).toFixed(1) + '%';

    const els = id => document.getElementById(id);

    function getInputs(){
      const g = k => parseFloat(els(k).value) || 0;
      const capex_total = g('capex_walls')+g('capex_fitout')+g('capex_holds')+g('capex_equipment')+g('capex_wc')+g('capex_cont');
      return {
        members_start:g('members_start'), members_net_new:g('members_net_new'), churn_pct:g('churn_pct')/100, m_price:g('m_price'),
        visits:g('visits'), d_price:g('d_price'), retail_per_visit:g('retail_per_visit'), coach_rev:g('coach_rev'),
        rent:g('rent'), rates:g('rates'), service_charge:g('service_charge'), utilities:g('utilities'), staff:g('staff'), insurance:g('insurance'), marketing:g('marketing'), maintenance:g('maintenance'), other_opex:g('other_opex'), cogs_pct:g('cogs_pct')/100,
        capex_total,
        equity:g('equity'), loan_amt:g('loan_amt'), loan_rate:g('loan_rate')/100, loan_years:g('loan_years'), io_months:g('io_months'),
        price_growth:g('price_growth')/100, visit_growth:g('visit_growth')/100, opex_infl:g('opex_infl')/100
      }
    }

    function buildModel(){
      const p = getInputs();

      // Members over 12 months simple cohort: M_{t+1} = M_t + net_new - churn*M_t
      let members = p.members_start;
      let member_months = 0; // sum of active members each month
      for(let m=0;m<12;m++){
        member_months += members;
        members = Math.max(0, members + p.members_net_new - p.churn_pct*members);
      }
      const avg_members = member_months/12;
      const rev_membership_m = avg_members * p.m_price; // monthly
      const rev_membership_y = rev_membership_m * 12;

      // Day passes and retail
      const rev_daypass_m = p.visits * p.d_price;
      const rev_retail_m = p.visits * p.retail_per_visit;
      const rev_coach_m = p.coach_rev;
      const rev_total_y = 12*(rev_membership_m + rev_daypass_m + rev_retail_m + rev_coach_m);

      const cogs_y = 12*(p.cogs_pct*(rev_retail_m + rev_coach_m));

      const opex_m = p.rent + p.rates + p.service_charge + p.utilities + p.staff + p.insurance + p.marketing + p.maintenance + p.other_opex;
      const opex_y = opex_m * 12;

      const ebitda_y = rev_total_y - cogs_y - opex_y;

      // Debt schedule
      const r = p.loan_rate/12; // monthly rate
      const n = p.loan_years*12; // months
      const io = Math.min(p.io_months, n);
      const annuity = r>0 ? (p.loan_amt * r) / (1 - Math.pow(1+r, -(n-io))) : p.loan_amt/(n-io);
      let bal = p.loan_amt;
      let schedule = [];
      for(let i=1;i<=24;i++){
        let interest = bal * r;
        let principal = 0;
        let payment = 0;
        if(i<=io){ // interest only
          payment = interest;
          principal = 0;
        } else {
          payment = annuity;
          principal = Math.max(0, payment - interest);
          bal = Math.max(0, bal - principal);
        }
        schedule.push({month:i, payment, interest, principal, balance:bal});
      }

      // Debt service for Year 2 for DSCR (after IO period) => 12 months of annuity
      const debt_service_y = (io<n) ? annuity*12 : schedule.slice(0,12).reduce((a,b)=>a+b.payment,0);
      const dscr = debt_service_y>0 ? (ebitda_y / debt_service_y) : 999;

      // Net income rough view before tax
      const interest_y = schedule.slice(0,12).reduce((a,b)=>a+b.interest,0);
      const ebit_y = ebitda_y - 0; // no DA model here
      const profit_bt_y = ebit_y - interest_y;

      // Breakeven daily visits using day pass margin contribution only
      const fixed_m = opex_m + (cogs_y/12)*0; // ignore COGS for day pass since set to retail only
      const cm_per_visit = p.d_price + p.retail_per_visit*0.3; // rough contribution
      const breakeven_visits_day = cm_per_visit>0 ? Math.ceil((fixed_m - rev_membership_m - rev_coach_m)/cm_per_visit/30) : 0;

      // Five year projection simple growth
      let rows = [];
      let members_price = p.m_price;
      let visits_m = p.visits;
      let opex_y_g = opex_y;
      for(let y=1;y<=5;y++){
        if(y>1){
          members_price *= (1+p.price_growth);
          visits_m *= (1+p.visit_growth);
          opex_y_g *= (1+p.opex_infl);
        }
        const rev_members_y = rev_membership_y * Math.pow(1+p.price_growth, y-1); // approx
        const rev_day_y = 12*(visits_m * p.d_price);
        const rev_retail_y = 12*(visits_m * p.retail_per_visit);
        const rev_coach_y = rev_coach_m * 12;
        const rev_y = rev_members_y + rev_day_y + rev_retail_y + rev_coach_y;
        const cogs_proj = 0.35*(rev_retail_y + rev_coach_y);
        const ebitda_proj = rev_y - cogs_proj - opex_y_g;
        const debt_y = (y===1) ? schedule.slice(0,12).reduce((a,b)=>a+b.payment,0) : annuity*12;
        const dscr_y = debt_y>0 ? ebitda_proj/debt_y : 999;
        rows.push({y, rev:rev_y, ebitda:ebitda_proj, debt:debt_y, dscr:dscr_y});
      }

      // Render
      els('kpi_rev').textContent = £(rev_total_y);
      els('kpi_ebitda').textContent = £(ebitda_y);
      els('kpi_dscr').textContent = dscr.toFixed(2);
      const dscrBox = els('kpi_dscr_box');
      dscrBox.classList.remove('good','warn','bad');
      dscrBox.classList.add(dscr>=1.5?'good':(dscr>=1.2?'warn':'bad'));
      els('kpi_breakeven').textContent = Math.max(0,breakeven_visits_day);

      // Year 1 table
      const y1 = [
        ['Membership revenue', £(rev_membership_y)],
        ['Day pass revenue', £(12*rev_daypass_m)],
        ['Retail revenue', £(12*rev_retail_m)],
        ['Coaching revenue', £(12*rev_coach_m)],
        ['Revenue total', £(rev_total_y)],
        ['COGS', '− '+£(cogs_y)],
        ['Operating costs', '− '+£(opex_y)],
        ['EBITDA', £(ebitda_y)],
        ['Interest year 1', '− '+£(interest_y)],
        ['Profit before tax', £(profit_bt_y)]
      ];
      renderTable('summaryY1', ['Line item','Value'], y1);

      // Bars
      drawBars('chartBars', [rev_total_y, cogs_y, opex_y, ebitda_y], ['#38bdf8','#fb7185','#f59e0b','#34d399']);

      // Projection table
      renderTable('proj', ['Year','Revenue','EBITDA','Debt service','DSCR'], rows.map(r=>[r.y, £(r.rev), £(r.ebitda), £(r.debt), r.dscr.toFixed(2)]));

      // Debt schedule
      renderTable('debt', ['Month','Payment','Interest','Principal','Balance'], schedule.map(r=>[r.month, £(r.payment), £(r.interest), £(r.principal), £(r.balance)]));

      // Assumptions
      const asum = [
        ['Members at start', formatNum(p.members_start)],
        ['Net new per month', formatNum(p.members_net_new)],
        ['Churn monthly', pct(p.churn_pct*100)],
        ['Member price', £(p.m_price)],
        ['Visits per month', formatNum(p.visits)],
        ['Day pass price', £(p.d_price)],
        ['Retail per visit', £(p.retail_per_visit)],
        ['Coaching per month', £(p.coach_rev)],
        ['Opex per month', £(opex_m)],
        ['Capex total', £(p.capex_total)],
        ['Equity', £(p.equity)],
        ['Loan amount', £(p.loan_amt)],
        ['Interest annual', pct(p.loan_rate*100)],
        ['Term years', formatNum(p.loan_years)],
        ['Interest only months', formatNum(p.io_months)]
      ];
      renderTable('assump', ['Item','Value'], asum);

      return {rows,schedule};
    }

    function renderTable(id, headers, rows){
      const t = els(id);
      let html = '<tr>' + headers.map(h=>`<th>${h}</th>`).join('') + '</tr>';
      html += rows.map(r=>'<tr>'+r.map(c=>`<td>${c}</td>`).join('')+'</tr>').join('');
      t.innerHTML = html;
    }

    function drawBars(id, values, colors){
      const el = els(id);
      el.innerHTML = '';
      const max = Math.max(...values.map(v=>Math.abs(v)))*1.1 || 1;
      values.forEach((v,i)=>{
        const b = document.createElement('div');
        b.className = 'bar';
        b.style.left = (i*22+8)+'%';
        b.style.height = (Math.abs(v)/max*100)+'%';
        b.style.background = `linear-gradient(180deg, ${colors[i]}, ${colors[i]})`;
        el.appendChild(b);
      });
    }

    function formatNum(n){
      return new Intl.NumberFormat('en-GB').format(n||0);
    }

    function exportCSV(){
      // Build a simple CSV of the five year projection and year 1 summary
      const proj = document.getElementById('proj').innerText.replaceAll('\t', ',');
      const y1 = document.getElementById('summaryY1').innerText.replaceAll('\t', ',');
      const csv = 'Year 1 Summary\n' + y1 + '\n\nFive Year Projection\n' + proj;
      const blob = new Blob([csv], {type:'text/csv'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'queensgate_bouldering_financials.csv';
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function resetDefaults(){
      document.querySelectorAll('#inputsCard input').forEach(inp=>{ inp.value = inp.defaultValue; });
      buildModel();
    }

    // Wire up
    document.getElementById('btnExport').addEventListener('click', exportCSV);
    document.getElementById('btnReset').addEventListener('click', resetDefaults);
    document.querySelectorAll('#inputsCard input').forEach(inp=>{
      inp.addEventListener('input', buildModel);
    });

    buildModel();
  </script>
</body>
</html>
